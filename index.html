<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ExeTickets - Dynamic Cards</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #f0f4f8, #e4ecf4);
      overflow-x: hidden;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .card-container {
      display: flex;
      overflow-x: auto;
      gap: 20px;
      padding: 20px 0;
      align-items: flex-start;
    }
    .card {
      min-width: 300px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      padding: 20px;
      position: relative;
      transition: all 0.3s ease;
    }
    .card.collapsed .details { display: none; }
    .summary {
      display: none;
      font-size: 14px;
      color: #333;
      margin-bottom: 10px;
    }
    .card.collapsed .summary { display: block; }
    .collapse-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #eee;
      border: none;
      border-radius: 4px;
      padding: 3px 6px;
      cursor: pointer;
    }
    .input-group { margin-bottom: 12px; }
    label { font-weight: 500; display: block; margin-bottom: 5px; }
    input, select {
      width: 100%;
      padding: 10px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .fare-options {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .fare-box {
      flex: 1;
      margin: 0 5px;
      background: rgba(255,255,255,0.25);
      backdrop-filter: blur(4px);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    .fare-box:hover, .fare-box.selected {
      background: #c7342a;
      color: white;
    }
    .glass-button {
      padding: 12px 20px;
      border-radius: 12px;
      border: none;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(6px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    .glass-button:hover { background: rgba(255, 255, 255, 0.35); }
    .popup {
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      padding: 20px;
      z-index: 1000;
      width: 90%;
      max-width: 400px;
    }
    .popup h3 { text-align: center; }
    .popup .ticket-list .ticket-item {
      padding: 10px;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
    }
    .popup .ticket-item:hover { background: #f0f0f0; }
    .popup .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>ExeTickets - Book Tickets</h2>
  <div class="card-container" id="cardContainer"></div>
  <div class="controls">
    <button class="glass-button" onclick="addCard()">Add Card</button>
    <button class="glass-button" onclick="buySelectedTicket()">Buy Ticket</button>
  </div>  <div class="popup" id="fillPreviousPopup" style="display:none">
    <span class="close" onclick="document.getElementById('fillPreviousPopup').style.display='none'">&times;</span>
    <h3>Select Previous Ticket</h3>
    <div class="ticket-list"></div>
  </div>  <script>
    let cardCounter = 0;
    let selectedCardId = null;

    function generateOneDelhiTicketID() {
      const now = new Date();
      const dd = String(now.getDate()).padStart(2, '0');
      const mm = String(now.getMonth() + 1).padStart(2, '0');
      const yyyy = now.getFullYear();
      const randomHex = Math.random().toString(16).substring(2, 12);
      return `T${dd}${mm}${yyyy}${randomHex}`;
    }

    function addCard() {
      const id = `card-${++cardCounter}`;
      const card = document.createElement("div");
      card.className = "card";
      card.setAttribute("data-id", id);
      card.innerHTML = `
        <button class="collapse-btn" onclick="toggleCollapse(event, '${id}')">-</button>
        <div class="summary"></div>
        <div class="details">
          <div class="input-group">
            <label>Bus Number</label>
            <input type="text" class="bus-number" />
          </div>
          <div class="input-group">
            <label>Route</label>
            <input type="text" class="route-name" />
          </div>
          <div class="input-group">
            <label>Start</label>
            <input type="text" class="start" />
          </div>
          <div class="input-group">
            <label>End</label>
            <input type="text" class="end" />
          </div>
          <div class="fare-options">
            ${[5,10,15,25].map(f => `<div class="fare-box" onclick="selectFare(this, ${f})">₹${f}</div>`).join('')}
          </div>
          <div style="margin-top:10px; text-align:center;">
            <button class="glass-button" onclick="openFillPrevious(event, '${id}')">Fill Previous</button>
          </div>
        </div>
      `;
      document.getElementById("cardContainer").appendChild(card);
      selectCard(id);
    }

    function selectCard(id) {
      selectedCardId = id;
      document.querySelectorAll(".card").forEach(card => {
        card.style.border = card.getAttribute("data-id") === id ? "2px solid #007bff" : "none";
      });
    }

    function toggleCollapse(e, id) {
      e.stopPropagation();
      const card = document.querySelector(`[data-id='${id}']`);
      card.classList.toggle("collapsed");
      const btn = card.querySelector(".collapse-btn");
      btn.textContent = card.classList.contains("collapsed") ? "+" : "-";

      const summary = card.querySelector(".summary");
      if (card.classList.contains("collapsed")) {
        const number = card.querySelector(".bus-number").value;
        const route = card.querySelector(".route-name").value;
        const start = card.querySelector(".start").value;
        const end = card.querySelector(".end").value;
        const fareBox = card.querySelector(".fare-box.selected");
        const fare = fareBox ? fareBox.textContent : 'N/A';
        summary.innerHTML = `<b>${number}</b><br>${route}<br>${start} → ${end}<br>${fare}`;
      }
    }

    function selectFare(box, amount) {
      const siblings = box.parentNode.querySelectorAll('.fare-box');
      siblings.forEach(b => b.classList.remove('selected'));
      box.classList.add('selected');
      box.parentNode.setAttribute('data-fare', amount);
    }

    function buySelectedTicket() {
      if (!selectedCardId) return alert("Select a card");
      const card = document.querySelector(`[data-id='${selectedCardId}']`);
      const number = card.querySelector(".bus-number").value;
      const route = card.querySelector(".route-name").value;
      const start = card.querySelector(".start").value;
      const end = card.querySelector(".end").value;
      const fareBox = card.querySelector(".fare-box.selected");
      const fare = fareBox ? parseInt(fareBox.textContent.replace('₹','')) : null;

      if (!number || !route || !start || !end || !fare) return alert("Fill all fields and select fare");

      const ticket = {
        id: generateOneDelhiTicketID(),
        number, routeName: route, route: `${start} → ${end}`,
        time: new Date().toISOString(),
        price: fare,
      };
      const all = JSON.parse(localStorage.getItem("tickets") || "[]");
      all.push(ticket);
      localStorage.setItem("tickets", JSON.stringify(all));
      alert("Ticket saved: " + ticket.id);
    }

    function openFillPrevious(e, cardId) {
      e.stopPropagation();
      const popup = document.getElementById("fillPreviousPopup");
      popup.style.display = "block";
      popup.setAttribute("data-target", cardId);
      const list = popup.querySelector(".ticket-list");
      list.innerHTML = "";
      const all = JSON.parse(localStorage.getItem("tickets") || "[]").reverse().slice(0, 10);
      if (!all.length) {
        list.innerHTML = "<p>No tickets found.</p>";
      } else {
        all.forEach(ticket => {
          const item = document.createElement("div");
          item.className = "ticket-item";
          item.innerHTML = `<b>${ticket.number}</b> - ${ticket.routeName}<br><small>${ticket.route}</small>`;
          item.onclick = () => fillCardWithData(cardId, ticket);
          list.appendChild(item);
        });
      }
    }

    function fillCardWithData(cardId, data) {
      const card = document.querySelector(`[data-id='${cardId}']`);
      card.querySelector(".bus-number").value = data.number;
      card.querySelector(".route-name").value = data.routeName;
      const [start, end] = data.route.split(" → ");
      card.querySelector(".start").value = start;
      card.querySelector(".end").value = end;
      const fareBoxes = card.querySelectorAll(".fare-box");
      fareBoxes.forEach(b => {
        b.classList.remove("selected");
        if (parseInt(b.textContent.replace('₹','')) === data.price) b.classList.add("selected");
      });
      document.getElementById("fillPreviousPopup").style.display = "none";
    }

    window.onload = () => addCard();
  </script></body>
</html>